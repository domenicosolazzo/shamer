{% extends "_base.html" %}
{% block title %}Coverager Demo{% endblock %}
{% block body %}

<h1>Coverager Demo</h1>

<p>
  <img src="{{ user.user.avatar_url }}" width='30' height='30' />
  {{ user.user.name }} ({{ user.user.email }}) from 
  {{ user.user.company if user.user.company else user.user.location }}
</p>
<p>
  <h4>Validations</h4>
  <ul>
    <li>User is part of org {{ v_org[0] }}: <b> {{ user.verify_org(v_org[1]) }} </b></li>
    <li>User has push access to repo {{ v_repo[0] }}: <b> {{ user.verify_repo(v_repo[1]) }} </b></li>
    <li>User will be redirected to S3: <b> {{ user.verify_org(v_org[1]) and user.verify_repo(v_repo[1]) }} </b></li>
  </ul>
</p>

<p>
  <h4>View Coverage</h4>
  <p>
    CI Build Number: 
    <input type='text' id='ci_build_number'>
    <button type='button' id='ci_build_number_btn' class='btn btn-default'>Go!</button>
  </p>
</p>

{% if user.user.bio %}
<p>
{{ user.user.bio }}
</p>
{% endif %}

<script>
  $(document).ready(function() {
    $('#ci_build_number_btn').click(function() {
      ci_build_number = $('#ci_build_number').val();
      object_key = "dashboard/ci_build_number/coverage/index.html".replace('ci_build_number', ci_build_number);
      url = "{{ url_for('go_view', object_key='object_key') }}".replace('object_key', object_key);
      window.location = url + '?' + encodeURIComponent('CI Build #' + ci_build_number);
    });
  });
</script>

{% endblock %}
